"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var fileSystemModule = require("file-system");
var faker = require("faker");
var static_data_1 = require("~/shared/static-data");
var NUM_SPEAKERS = 40;
var NUM_ROOM_INFOS = 10;
var SESSION_LENGTH = 60;
function generateSpeakers() {
    var speakerList = [];
    var avartarsMen = getSpeakerAvatars('images/speakers/base64/men.txt');
    var avatarsWomen = getSpeakerAvatars('images/speakers/base64/women.txt');
    for (var i = 0; i <= NUM_SPEAKERS; i++) {
        var genderBool = faker.random.boolean();
        var genderInt = parseInt(genderBool + '');
        var firstName = faker.name.firstName(genderInt);
        var lastName = faker.name.lastName(genderInt);
        var picture = genderBool ? avartarsMen[faker.random.number(avartarsMen.length - 1)] : avatarsWomen[faker.random.number(avatarsWomen.length - 1)];
        var speaker = {
            id: faker.random.uuid(),
            name: firstName + ' ' + lastName,
            title: faker.name.jobTitle(),
            company: faker.company.companyName(),
            picture: picture,
            twitterName: '@' + faker.internet.userName(firstName, lastName)
        };
        speakerList.push(speaker);
    }
    return speakerList;
}
exports.generateSpeakers = generateSpeakers;
function generateRoomInfos() {
    var roomInfoList = [];
    for (var i = 0; i <= NUM_ROOM_INFOS; i++) {
        var roomInfo = {
            roomId: faker.random.uuid(),
            name: faker.address.streetName() + ' ' + faker.random.number(10),
            url: faker.internet.domainName(),
            theme: faker.lorem.words(1)
        };
        roomInfoList.push(roomInfo);
    }
    return roomInfoList;
}
exports.generateRoomInfos = generateRoomInfos;
function generateSessions(speakers, roomInfos) {
    var sessionList = [];
    var idSeed = 1000;
    for (var _i = 0, conferenceDays_1 = static_data_1.conferenceDays; _i < conferenceDays_1.length; _i++) {
        var conferenceDay = conferenceDays_1[_i];
        var timeSlots = generateTimeSlots(conferenceDay);
        for (var _a = 0, timeSlots_1 = timeSlots; _a < timeSlots_1.length; _a++) {
            var conferenceTimeSlot = timeSlots_1[_a];
            if (conferenceTimeSlot.isBreak) {
                // break session
                var session = {
                    id: (idSeed++).toString(),
                    title: toTitleCase(conferenceTimeSlot.title),
                    isBreak: true,
                    start: conferenceTimeSlot.start.toString(),
                    end: conferenceTimeSlot.end.toString(),
                    room: '',
                    roomInfo: null,
                    speakers: [],
                    description: '',
                    descriptionShort: '',
                    calendarEventId: ''
                };
                sessionList.push(session);
            }
            else {
                //speaker session
                var subSpeakers = getRandomArrayElements(speakers, faker.random.number(3));
                var roomInfo = roomInfos[faker.random.number(roomInfos.length - 1)];
                var session = {
                    id: (idSeed++).toString(),
                    title: toTitleCase(faker.company.bs()),
                    isBreak: false,
                    start: conferenceTimeSlot.start.toString(),
                    end: conferenceTimeSlot.end.toString(),
                    room: roomInfo.name,
                    roomInfo: roomInfo,
                    speakers: subSpeakers,
                    description: faker.lorem.paragraph(),
                    descriptionShort: faker.lorem.sentence(),
                    calendarEventId: faker.random.uuid()
                };
                sessionList.push(session);
            }
        }
    }
    return sessionList;
}
exports.generateSessions = generateSessions;
function getSpeakerAvatars(path) {
    var avatarList = [];
    var currentAppFoler = fileSystemModule.knownFolders.currentApp();
    var menAvatarsFile = currentAppFoler.getFile(path);
    var fileText = menAvatarsFile.readTextSync();
    var lines = fileText.split('\n');
    for (var i = 0; i < lines.length; i++) {
        avatarList.push('data:image/png;base64,' + lines[i]);
    }
    return avatarList;
}
function generateTimeSlots(conferenceDay) {
    var timeSlotList = [];
    var startTimeList = getTimeRange(addMinutes(conferenceDay.date, 240), addMinutes(conferenceDay.date, 780), SESSION_LENGTH);
    for (var _i = 0, startTimeList_1 = startTimeList; _i < startTimeList_1.length; _i++) {
        var startTime = startTimeList_1[_i];
        var isBreak = false;
        var sessionTitle = '';
        if (startTime.getHours() === 4) {
            isBreak = true;
            sessionTitle = 'Welcome Message';
        }
        else if (startTime.getHours() === 8) {
            isBreak = true;
            sessionTitle = 'Lunch Break';
        }
        var cTimeSlot = {
            title: sessionTitle,
            isBreak: isBreak,
            start: startTime,
            end: addMinutes(startTime, SESSION_LENGTH)
        };
        timeSlotList.push(cTimeSlot);
    }
    return timeSlotList;
}
function getTimeRange(startTime, endTime, minutesBetween) {
    var startTimeList = [];
    var diffInMinutes = Math.round((endTime.getTime() - startTime.getTime()) / 60000);
    var periods = diffInMinutes / minutesBetween;
    for (var i = 0; i <= periods; i++) {
        var periodStart = addMinutes(startTime, (minutesBetween * i));
        startTimeList.push(periodStart);
    }
    return startTimeList;
}
function addMinutes(date, minutes) {
    return new Date(date.getTime() + minutes * 60000);
}
function getRandomArrayElements(arr, count) {
    var shuffled = arr.slice(0), i = arr.length, min = i - count, temp, index;
    while (i-- > min) {
        index = Math.floor((i + 1) * Math.random());
        temp = shuffled[index];
        shuffled[index] = shuffled[i];
        shuffled[i] = temp;
    }
    return shuffled.slice(min);
}
function toTitleCase(str) {
    return str.replace(/\w\S*/g, function (txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFrZS1kYXRhLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmYWtlLWRhdGEuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDhDQUFnRDtBQUNoRCw2QkFBK0I7QUFHL0Isb0RBQXNEO0FBRXRELElBQU0sWUFBWSxHQUFHLEVBQUUsQ0FBQztBQUN4QixJQUFNLGNBQWMsR0FBRyxFQUFFLENBQUM7QUFDMUIsSUFBTSxjQUFjLEdBQUcsRUFBRSxDQUFDO0FBRTFCO0lBQ0ksSUFBTSxXQUFXLEdBQW1CLEVBQUUsQ0FBQztJQUN2QyxJQUFNLFdBQVcsR0FBRyxpQkFBaUIsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0lBQ3hFLElBQU0sWUFBWSxHQUFHLGlCQUFpQixDQUFDLGtDQUFrQyxDQUFDLENBQUM7SUFFM0UsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxZQUFZLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNyQyxJQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQzFDLElBQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDNUMsSUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbEQsSUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDaEQsSUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLE1B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QUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUMzQixDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFDZCxHQUFHLEdBQUcsQ0FBQyxHQUFHLEtBQUssRUFDZixJQUFJLEVBQ0osS0FBSyxDQUFDO0lBRU4sT0FBTSxDQUFDLEVBQUUsR0FBRyxHQUFHLEVBQUUsQ0FBQztRQUNkLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLElBQUksR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkIsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QixRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUMvQixDQUFDO0FBRUQscUJBQXFCLEdBQUc7SUFDcEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLFVBQVMsR0FBRztRQUNyQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3JFLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZpbGVTeXN0ZW1Nb2R1bGUgZnJvbSAnZmlsZS1zeXN0ZW0nO1xyXG5pbXBvcnQgKiBhcyBmYWtlciBmcm9tICdmYWtlcic7XHJcblxyXG5pbXBvcnQgeyBTZXNzaW9uLCBTcGVha2VyLCBSb29tSW5mbywgQ29uZmVyZW5jZURheSwgQ29uZmVyZW5jZVRpbWVTbG90IH0gZnJvbSBcIn4vc2hhcmVkL2ludGVyZmFjZXNcIjtcclxuaW1wb3J0IHsgY29uZmVyZW5jZURheXMgfSBmcm9tICd+L3NoYXJlZC9zdGF0aWMtZGF0YSc7XHJcblxyXG5jb25zdCBOVU1fU1BFQUtFUlMgPSA0MDtcclxuY29uc3QgTlVNX1JPT01fSU5GT1MgPSAxMDtcclxuY29uc3QgU0VTU0lPTl9MRU5HVEggPSA2MDtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNwZWFrZXJzKCk6IEFycmF5PFNwZWFrZXI+IHtcclxuICAgIGNvbnN0IHNwZWFrZXJMaXN0OiBBcnJheTxTcGVha2VyPiA9IFtdO1xyXG4gICAgY29uc3QgYXZhcnRhcnNNZW4gPSBnZXRTcGVha2VyQXZhdGFycygnaW1hZ2VzL3NwZWFrZXJzL2Jhc2U2NC9tZW4udHh0Jyk7XHJcbiAgICBjb25zdCBhdmF0YXJzV29tZW4gPSBnZXRTcGVha2VyQXZhdGFycygnaW1hZ2VzL3NwZWFrZXJzL2Jhc2U2NC93b21lbi50eHQnKTtcclxuICAgIFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gTlVNX1NQRUFLRVJTOyBpKyspIHtcclxuICAgICAgICBjb25zdCBnZW5kZXJCb29sID0gZmFrZXIucmFuZG9tLmJvb2xlYW4oKTtcclxuICAgICAgICBjb25zdCBnZW5kZXJJbnQgPSBwYXJzZUludChnZW5kZXJCb29sICsgJycpO1xyXG4gICAgICAgIGNvbnN0IGZpcnN0TmFtZSA9IGZha2VyLm5hbWUuZmlyc3ROYW1lKGdlbmRlckludCk7XHJcbiAgICAgICAgY29uc3QgbGFzdE5hbWUgPSBmYWtlci5uYW1lLmxhc3ROYW1lKGdlbmRlckludCk7XHJcbiAgICAgICAgY29uc3QgcGljdHVyZSA9IGdlbmRlckJvb2wgPyBhdmFydGFyc01lbltmYWtlci5yYW5kb20ubnVtYmVyKGF2YXJ0YXJzTWVuLmxlbmd0aCAtIDEpXSA6IGF2YXRhcnNXb21lbltmYWtlci5yYW5kb20ubnVtYmVyKGF2YXRhcnNXb21lbi5sZW5ndGggLSAxKV07XHJcblxyXG4gICAgICAgIGNvbnN0IHNwZWFrZXI6IFNwZWFrZXIgPSB7XHJcbiAgICAgICAgICAgIGlkOiBmYWtlci5yYW5kb20udXVpZCgpLFxyXG4gICAgICAgICAgICBuYW1lOiBmaXJzdE5hbWUgKyAnICcgKyBsYXN0TmFtZSxcclxuICAgICAgICAgICAgdGl0bGU6IGZha2VyLm5hbWUuam9iVGl0bGUoKSxcclxuICAgICAgICAgICAgY29tcGFueTogZmFrZXIuY29tcGFueS5jb21wYW55TmFtZSgpLFxyXG4gICAgICAgICAgICBwaWN0dXJlOiBwaWN0dXJlLFxyXG4gICAgICAgICAgICB0d2l0dGVyTmFtZTogJ0AnICsgZmFrZXIuaW50ZXJuZXQudXNlck5hbWUoZmlyc3ROYW1lLCBsYXN0TmFtZSlcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzcGVha2VyTGlzdC5wdXNoKHNwZWFrZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzcGVha2VyTGlzdDtcclxuICAgIFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVSb29tSW5mb3MoKTogQXJyYXk8Um9vbUluZm8+IHtcclxuICAgIGNvbnN0IHJvb21JbmZvTGlzdDogQXJyYXk8Um9vbUluZm8+ID0gW107XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gTlVNX1JPT01fSU5GT1M7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IHJvb21JbmZvOiBSb29tSW5mbyA9IHtcclxuICAgICAgICAgICAgcm9vbUlkOiBmYWtlci5yYW5kb20udXVpZCgpLFxyXG4gICAgICAgICAgICBuYW1lOiBmYWtlci5hZGRyZXNzLnN0cmVldE5hbWUoKSArICcgJyArIGZha2VyLnJhbmRvbS5udW1iZXIoMTApLFxyXG4gICAgICAgICAgICB1cmw6IGZha2VyLmludGVybmV0LmRvbWFpbk5hbWUoKSxcclxuICAgICAgICAgICAgdGhlbWU6IGZha2VyLmxvcmVtLndvcmRzKDEpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcm9vbUluZm9MaXN0LnB1c2gocm9vbUluZm8pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByb29tSW5mb0xpc3Q7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNlc3Npb25zKHNwZWFrZXJzOiBBcnJheTxTcGVha2VyPiwgcm9vbUluZm9zOiBBcnJheTxSb29tSW5mbz4pOiBBcnJheTxTZXNzaW9uPiB7XHJcbiAgICBjb25zdCBzZXNzaW9uTGlzdDogQXJyYXk8U2Vzc2lvbj4gPSBbXTtcclxuICAgIGxldCBpZFNlZWQgPSAxMDAwO1xyXG5cclxuICAgIGZvciAobGV0IGNvbmZlcmVuY2VEYXkgb2YgY29uZmVyZW5jZURheXMpIHtcclxuICAgICAgICBjb25zdCB0aW1lU2xvdHMgPSBnZW5lcmF0ZVRpbWVTbG90cyhjb25mZXJlbmNlRGF5KTtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgY29uZmVyZW5jZVRpbWVTbG90IG9mIHRpbWVTbG90cykge1xyXG4gICAgICAgICAgICBpZiAoY29uZmVyZW5jZVRpbWVTbG90LmlzQnJlYWspIHtcclxuICAgICAgICAgICAgICAgIC8vIGJyZWFrIHNlc3Npb25cclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlc3Npb246IFNlc3Npb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IChpZFNlZWQrKykudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdG9UaXRsZUNhc2UoY29uZmVyZW5jZVRpbWVTbG90LnRpdGxlKSxcclxuICAgICAgICAgICAgICAgICAgICBpc0JyZWFrOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBjb25mZXJlbmNlVGltZVNsb3Quc3RhcnQudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICBlbmQ6IGNvbmZlcmVuY2VUaW1lU2xvdC5lbmQudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICByb29tOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICByb29tSW5mbzogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBzcGVha2VyczogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uU2hvcnQ6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyRXZlbnRJZDogJydcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgc2Vzc2lvbkxpc3QucHVzaChzZXNzaW9uKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vc3BlYWtlciBzZXNzaW9uXHJcbiAgICAgICAgICAgICAgICBjb25zdCBzdWJTcGVha2VycyA9IGdldFJhbmRvbUFycmF5RWxlbWVudHMoc3BlYWtlcnMsIGZha2VyLnJhbmRvbS5udW1iZXIoMykpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vbUluZm8gPSByb29tSW5mb3NbZmFrZXIucmFuZG9tLm51bWJlcihyb29tSW5mb3MubGVuZ3RoIC0gMSldO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlc3Npb246IFNlc3Npb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IChpZFNlZWQrKykudG9TdHJpbmcoKSxcclxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogdG9UaXRsZUNhc2UoZmFrZXIuY29tcGFueS5icygpKSxcclxuICAgICAgICAgICAgICAgICAgICBpc0JyZWFrOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBzdGFydDogY29uZmVyZW5jZVRpbWVTbG90LnN0YXJ0LnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kOiBjb25mZXJlbmNlVGltZVNsb3QuZW5kLnRvU3RyaW5nKCksXHJcbiAgICAgICAgICAgICAgICAgICAgcm9vbTogcm9vbUluZm8ubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICByb29tSW5mbzogcm9vbUluZm8sXHJcbiAgICAgICAgICAgICAgICAgICAgc3BlYWtlcnM6IHN1YlNwZWFrZXJzLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBmYWtlci5sb3JlbS5wYXJhZ3JhcGgoKSxcclxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvblNob3J0OiBmYWtlci5sb3JlbS5zZW50ZW5jZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbGVuZGFyRXZlbnRJZDogZmFrZXIucmFuZG9tLnV1aWQoKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXNzaW9uTGlzdC5wdXNoKHNlc3Npb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBzZXNzaW9uTGlzdDtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0U3BlYWtlckF2YXRhcnMocGF0aCkge1xyXG4gICAgY29uc3QgYXZhdGFyTGlzdDogQXJyYXk8c3RyaW5nPiA9IFtdO1xyXG4gICAgY29uc3QgY3VycmVudEFwcEZvbGVyID0gZmlsZVN5c3RlbU1vZHVsZS5rbm93bkZvbGRlcnMuY3VycmVudEFwcCgpO1xyXG4gICAgY29uc3QgbWVuQXZhdGFyc0ZpbGUgPSBjdXJyZW50QXBwRm9sZXIuZ2V0RmlsZShwYXRoKTtcclxuICAgIGNvbnN0IGZpbGVUZXh0ID0gbWVuQXZhdGFyc0ZpbGUucmVhZFRleHRTeW5jKCk7XHJcblxyXG4gICAgY29uc3QgbGluZXMgPSBmaWxlVGV4dC5zcGxpdCgnXFxuJyk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGF2YXRhckxpc3QucHVzaCgnZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcgKyBsaW5lc1tpXSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGF2YXRhckxpc3Q7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlVGltZVNsb3RzKGNvbmZlcmVuY2VEYXk6IENvbmZlcmVuY2VEYXkpOiBBcnJheTxDb25mZXJlbmNlVGltZVNsb3Q+IHtcclxuICAgIGNvbnN0IHRpbWVTbG90TGlzdDogQXJyYXk8Q29uZmVyZW5jZVRpbWVTbG90PiA9IFtdO1xyXG4gICAgY29uc3Qgc3RhcnRUaW1lTGlzdCA9IGdldFRpbWVSYW5nZShhZGRNaW51dGVzKGNvbmZlcmVuY2VEYXkuZGF0ZSwgMjQwKSwgYWRkTWludXRlcyhjb25mZXJlbmNlRGF5LmRhdGUsIDc4MCksIFNFU1NJT05fTEVOR1RIKTtcclxuXHJcbiAgICBmb3IgKGxldCBzdGFydFRpbWUgb2Ygc3RhcnRUaW1lTGlzdCkge1xyXG4gICAgICAgIGxldCBpc0JyZWFrID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IHNlc3Npb25UaXRsZSA9ICcnO1xyXG5cclxuICAgICAgICBpZiAoc3RhcnRUaW1lLmdldEhvdXJzKCkgPT09IDQpIHtcclxuICAgICAgICAgICAgaXNCcmVhayA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlc3Npb25UaXRsZSA9ICdXZWxjb21lIE1lc3NhZ2UnO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRUaW1lLmdldEhvdXJzKCkgPT09IDgpIHtcclxuICAgICAgICAgICAgaXNCcmVhayA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlc3Npb25UaXRsZSA9ICdMdW5jaCBCcmVhayc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBjVGltZVNsb3Q6IENvbmZlcmVuY2VUaW1lU2xvdCA9IHtcclxuICAgICAgICAgICAgdGl0bGU6IHNlc3Npb25UaXRsZSxcclxuICAgICAgICAgICAgaXNCcmVhazogaXNCcmVhayxcclxuICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0VGltZSxcclxuICAgICAgICAgICAgZW5kOiBhZGRNaW51dGVzKHN0YXJ0VGltZSwgU0VTU0lPTl9MRU5HVEgpXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGltZVNsb3RMaXN0LnB1c2goY1RpbWVTbG90KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgcmV0dXJuIHRpbWVTbG90TGlzdDtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VGltZVJhbmdlKHN0YXJ0VGltZTogRGF0ZSwgZW5kVGltZTogRGF0ZSwgbWludXRlc0JldHdlZW46IG51bWJlcik6IEFycmF5PERhdGU+IHtcclxuICAgIGNvbnN0IHN0YXJ0VGltZUxpc3Q6IEFycmF5PERhdGU+ID0gW107XHJcbiAgICBjb25zdCBkaWZmSW5NaW51dGVzID0gTWF0aC5yb3VuZCgoZW5kVGltZS5nZXRUaW1lKCkgLSBzdGFydFRpbWUuZ2V0VGltZSgpKSAvIDYwMDAwKTtcclxuICAgIGNvbnN0IHBlcmlvZHM6IG51bWJlciA9IGRpZmZJbk1pbnV0ZXMgLyBtaW51dGVzQmV0d2VlbjtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBwZXJpb2RzOyBpKyspIHtcclxuICAgICAgICBjb25zdCBwZXJpb2RTdGFydCA9IGFkZE1pbnV0ZXMoc3RhcnRUaW1lLCAobWludXRlc0JldHdlZW4gKiBpKSk7XHJcbiAgICAgICAgc3RhcnRUaW1lTGlzdC5wdXNoKHBlcmlvZFN0YXJ0KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gc3RhcnRUaW1lTGlzdDtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkTWludXRlcyhkYXRlOiBEYXRlLCBtaW51dGVzOiBudW1iZXIpIHtcclxuICAgIHJldHVybiBuZXcgRGF0ZShkYXRlLmdldFRpbWUoKSArIG1pbnV0ZXMgKiA2MDAwMCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFJhbmRvbUFycmF5RWxlbWVudHMoYXJyLCBjb3VudCkge1xyXG4gICAgbGV0IHNodWZmbGVkID0gYXJyLnNsaWNlKDApLFxyXG4gICAgaSA9IGFyci5sZW5ndGgsXHJcbiAgICBtaW4gPSBpIC0gY291bnQsXHJcbiAgICB0ZW1wLFxyXG4gICAgaW5kZXg7XHJcblxyXG4gICAgd2hpbGUoaS0tID4gbWluKSB7XHJcbiAgICAgICAgaW5kZXggPSBNYXRoLmZsb29yKChpICsgMSkgKiBNYXRoLnJhbmRvbSgpKTtcclxuICAgICAgICB0ZW1wID0gc2h1ZmZsZWRbaW5kZXhdO1xyXG4gICAgICAgIHNodWZmbGVkW2luZGV4XSA9IHNodWZmbGVkW2ldO1xyXG4gICAgICAgIHNodWZmbGVkW2ldID0gdGVtcDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gc2h1ZmZsZWQuc2xpY2UobWluKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdG9UaXRsZUNhc2Uoc3RyKSB7XHJcbiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1xcd1xcUyovZywgZnVuY3Rpb24odHh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHR4dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR4dC5zdWJzdHIoMSkudG9Mb3dlckNhc2UoKTtcclxuICAgIH0pO1xyXG59Il19